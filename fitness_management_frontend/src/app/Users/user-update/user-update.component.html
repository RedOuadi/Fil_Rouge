<div class="container">
  <h2>Update User</h2>
  <form [formGroup]="userForm" (ngSubmit)="onSubmit()" *ngIf="currentUser">
    <div class="form-group">
      <label for="nom">Nom</label>
      <input type="text" id="nom" formControlName="nom" class="form-control" />
      <div *ngIf="userForm.controls['nom'].invalid && userForm.controls['nom'].touched" class="text-danger">
        <small *ngIf="userForm.controls['nom'].hasError('required')">Nom is required.</small>
        <small *ngIf="userForm.controls['nom'].hasError('minlength')">Nom must be at least 2 characters long.</small>
      </div>
    </div>

    <div class="form-group">
      <label for="prenom">Prénom</label>
      <input type="text" id="prenom" formControlName="prenom" class="form-control" />
      <div *ngIf="userForm.controls['prenom'].invalid && userForm.controls['prenom'].touched" class="text-danger">
        <small *ngIf="userForm.controls['prenom'].hasError('required')">Prénom is required.</small>
        <small *ngIf="userForm.controls['prenom'].hasError('minlength')">Prénom must be at least 2 characters long.</small>
      </div>
    </div>

    <div class="form-group">
      <label for="email">Email</label>
      <input type="email" id="email" formControlName="email" class="form-control" />
      <div *ngIf="userForm.controls['email'].invalid && userForm.controls['email'].touched" class="text-danger">
        <small *ngIf="userForm.controls['email'].hasError('required')">Email is required.</small>
        <small *ngIf="userForm.controls['email'].hasError('email')">Please enter a valid email address.</small>
      </div>
    </div>

    <div class="form-group">
      <label for="genre">Genre</label>
      <select id="genre" formControlName="genre" class="form-control">
        <option value="">Select Genre</option>
        <option value="HOMME">Homme</option>
        <option value="FEMME">Femme</option>
      </select>
      <div *ngIf="userForm.get('genre')?.invalid && userForm.get('genre')?.touched" class="text-danger">
        <small>Genre is required.</small>
      </div>
    </div>

    <div class="form-group">
      <label for="role">Role</label>
      <select id="role" formControlName="role" class="form-control">
        <option value="ROLE_UTILISATEUR">Utilisateur</option>
        <option value="ROLE_COACH">Coach</option>
      </select>
    </div>

    <div class="form-group">
      <label for="profileImage">Update Profile Image (optional)</label>
      <input
        id="profileImage"
        type="file"
        accept="image/*"
        (change)="onFileChange($event)"
        class="form-control-file"
      />
    </div>

    <div class="mt-4" *ngIf="getProfileImageUrl()">
      <h4>Current Profile Image</h4>
      <img [src]="getProfileImageUrl()" alt="Current profile image" class="mb-2" style="max-width: 200px;">
      <p class="text-muted">Cloudinary ID: {{ currentUser.profileImage?.cloudinaryImageId }}</p>
    </div>

    <button type="submit" [disabled]="userForm.invalid" class="btn btn-primary mt-3">
      Update User
    </button>
  </form>

  <!-- Loading message -->
  <div *ngIf="!currentUser" class="alert alert-info">
    Loading user data...
  </div>

  <!-- Error message display -->
  <div *ngIf="errorMessage" class="alert alert-danger mt-3">
    {{ errorMessage }}
  </div>

  <!-- Form validation errors display -->
  <div *ngIf="userForm.invalid && userForm.touched" class="alert alert-warning mt-3">
    <p>Form is invalid. Please correct the errors below:</p>
    <ul>
      <li *ngFor="let key of Object.keys(userForm.controls)">
        <div *ngIf="userForm.controls[key].invalid && userForm.controls[key].touched">
          {{ key }}: {{ userForm.controls[key].errors | json }}
        </div>
      </li>
    </ul>
  </div>
</div>
